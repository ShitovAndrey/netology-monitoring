# Домашнее задание к занятию 17 «Инцидент-менеджмент»

## Задание  
Составьте постмортем на основе реального сбоя системы GitHub в 2018 году.

| Пункт                      | Описание                                                                                                                                                                                                                                                                                                                                  |
| :------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Краткое описание инцидента | В 22:52 UTC 21 октября роль primary ноды БД переехала в другой ДЦ и трафик приложения был переключен на неё. Вследствие чего данные на нодах кластера СУБД стали не консистентны.                                                                                                                                                         |
| Предшествующие события     | Плановые работы по замене вышедшего из строя оптического оборудования 100G.                                                                                                                                                                                                                                                               |
| Причина инцидента          | Потеря связи на 43 секунды между датацентрами.                                                                                                                                                                                                                                                                                            |
| Воздействие                | Деградация производительности сервиса GitHub. Из-за не консистентности данных и проблем репликации, функционал web-hook, и GitHub Pages был не доступен. Так же пользователи получали не действительные данные.                                                                                                                           |
| Обнаружение                | Инцидент был замечен инженерами группы быстрого реагирования. Затем был привлечен координатор инцидента, инженеры поддержки СУБД MySQL и систем резервного копирования.                                                                                                                                                                   |
| Реакция                    | Инженеры группы реагирования восстановили работу сервиса за 24 часа 11 минут.                                                                                                                                                                                                                                                             |
| Восстановление             | Было выполнено восстановление БД из резервных копий, восстановлена репликация нод кластера СУБД и перенесли роль primary ноды в целевой ДЦ. После чего был включен функционал web-hook, и GitHub Pages и система перешла к штатной работе.                                                                                                |
| Таймлайн                   | 22:52 UTC 21.10 - Начало плановых работ по замене вышедшего из строя оптического оборудования.<br> 22:52 UTC 21.10 - Смена лидера в соответствии с консенсусом Raft, достижения кворума в кластере СУБД MySQL и переезд primary ноды БД в другой ДЦ.<br> 22:54 UTC 21.10 - Возникновения алертов в системах мониторинга.<br> 23:02 UTC 21.10 - Определение инженерами группы реагирования некорректной топологии кластеров СУБД.<br> 23:07 UTC 21.10 - Группа реагирования вручную заблокировала работу инструментов развертывания, для предотвращения дополнительных изменений.<br> 23:09 UTC 21.10 - Группа реагирования перевела сайт в желтый статус. Был оповещен координатор инцидента.<br> 23:11 UTC 21.10 - Присоединился координатор инцидента и перевел статус сайта в красный.<br> 23:13 UTC 21.10 - Принято решение сохранить данные успевшие записаться на primary ноду.<br> 23:19 UTC 21.10 - Анализ кластеров СУБД показал что требуется прекратить выполнение заданий, которые записывают метаданные. Принято решение приостановить функционал web-hook, и GitHub Pages.<br> 00:05 UTC 22.10 - Разработка плана и применение процедур по отработки отказа MySQL.<br> 00:41 UTC 22.10 - Запуск восстановление из РК и синхронизации реплик между ДЦ.<br> 06:51 UTC 22.10 - Несколько кластеров завершили восстановление из резервных копий и начали репликацию новых данных.<br> 07:46 UTC 22.10 - GitHub опубликовал запись в блоге о статусе восстановительных работ.<br> 11:12 UTC 22.10 - Роль primary ноды БД возвращена в основной ДЦ.<br> 13:15 UTC 22.10 - Увеличились задержки репликации из-за пиковой нагрузки на GitHub.com. Подготовлены дополнительные реплики MySQL в основном ДЦ для распределения нагрузки.<br> 16:24 UTC 22.10 - Выполнили отработку отказа на исходную топологию.<br> 16:45 UTC 22.10 - Включили обработку очереди событий web-hook и GitHub Pages. Более 200000 полезных данных были удалены из-за истекшего TTL.<br> 16:45 UTC 22.10 - Приостановили обработку очереди событий web-hook и GitHub Pages и изменили значение TTL на более высокое. Снова включили обработку очереди событий web-hook и GitHub Pages.<br> 23:03 UTC 22.10 - Все ожидающие web-hook и GitHub Pages были обработаны, надёжность работы всех систем была подтверждена. Статус сайта был изменен на зеленый. |
| Последующие действия       | Сформерован следующий перечень мер по недопущению повторения. Настроить конфигурацию Orchestrator предотвращающую перенос primary роли БД в другой ДЦ. Реализовать проект поддержки резервирования ДЦ N+1 с целью выдерживать полный сбой одного ЦОД. Внедрить системную практику проверки сценариев сбоя и инвестировать в инструменты хаос-инжинеринга. |
|                            |                                                                                                                                                                                                                                                                                                                                           |

---